;; (defun add(x y)
;;   (+ x y))
;; (add 1 2)

(setq codeadd '((push (:const 1))
		(push (:const 2))
		(move SP FP)
		(push (:const 2))
		(jsr add)
		(halt)
		(label add)
		(move (fp -2) R1)
		(move (fp -1) R2)
		(add R1 R2)
		(move R2 R0)
		(rtn)))

(AREF (VM-REGISTERS ((VM-STACK-SIZE . 10) (VM-NAME . "vm")
		     (VM-MEMORY .
				#((PUSH (:CONST 1)) (PUSH (:CONST 2)) (MOVE SP FP) (PUSH (:CONST 2)) (JSR ADD) (HALT) (LABEL ADD) (MOVE (FP -2) R1) (MOVE (FP -1) R2) (ADD R1 R2)
				  (MOVE R2 R0) (RTN) NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL
				  NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL
				  NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL))
		     (VM-CODE-BEGIN . 0)
		     (VM-CODE-END . 11)
		     (VM-STACK-BEGIN . 12)
		     (VM-STACK-END . 21)
		     (VM-REGISTERS . #(0 0 0 0 0 0 0 0))
		     (VM-RUNNING)))
 3)
